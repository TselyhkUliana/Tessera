<Window x:Class="Tessera.App.View.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:Tessera.App"
        xmlns:vm ="clr-namespace:Tessera.App.ViewModel"
        xmlns:controls="clr-namespace:Tessera.App.Controls"
        d:DataContext="{d:DesignData Type=vm:MainWindowViewModel}"
        xmlns:diag="clr-namespace:System.Diagnostics;assembly=WindowsBase"
        mc:Ignorable="d"
        Title="Tessera" Height="550" Width="1400"
        WindowStartupLocation="CenterScreen" 
        TextOptions.TextFormattingMode="Display" FontFamily="Ascon Complex" SnapsToDevicePixels="True">

  <Window.Resources>
    <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
  </Window.Resources>

  <Grid>
    <Grid.ColumnDefinitions>
      <ColumnDefinition Width="*"/>
      <ColumnDefinition Width="Auto"/>
    </Grid.ColumnDefinitions>

    <DockPanel Grid.Column="0">
      <!--<UniformGrid DockPanel.Dock="Top" Margin="5" HorizontalAlignment="Left" Rows="1">
        <UniformGrid.Resources>
          <Style TargetType="Button">
            <Setter Property="Margin" Value="0 0 5 0"/>
            <Setter Property="Padding" Value="5 2"/>
          </Style>
        </UniformGrid.Resources>
        <Button Command="{Binding AddFileForMaterialCommand}" CommandParameter="{Binding CurrentSection}" ToolTip="{Binding AddFileForMaterialCommand.Hint}" Background="Transparent">
          <StackPanel Orientation="Horizontal">
            <Image Source="{Binding AddFileForMaterialCommand.Icon}" Width="16" Height="16" />
            <TextBlock Text="{Binding AddFileForMaterialCommand.Caption}" />
          </StackPanel>
        </Button>
        <Button Command="{Binding AddFileForSortamentCommand}" CommandParameter="{Binding CurrentSection}" ToolTip="{Binding AddFileForSortamentCommand.Hint}" Background="Transparent">
          <StackPanel Orientation="Horizontal">
            <Image Source="{Binding AddFileForSortamentCommand.Icon}" Width="16" Height="16"/>
            <TextBlock Text="{Binding AddFileForSortamentCommand.Caption}"/>
          </StackPanel>
        </Button>
      </UniformGrid>-->
      <StackPanel DockPanel.Dock="Bottom">
        <Button Content="Создать" Command="{Binding CreateCommand}" CommandParameter="{Binding SectionDefinitions}" VerticalAlignment="Bottom" HorizontalAlignment="Right" Margin="0 5 5 7" Padding="5 2"/>
      </StackPanel>
      <DataGrid x:Name="datagrid" ItemsSource="{Binding SectionDefinitions}" SelectedItem="{Binding CurrentSection}" Margin="5" BorderBrush="#e0e0e0" BeginningEdit="MyGrid_BeginningEdit" CellEditEnding="MyGrid_CellEditEnding">
        <DataGrid.Columns>
          <DataGridTemplateColumn Header="Материалы" CellTemplate="{StaticResource MaterialCell}" CellStyle="{StaticResource MaterialCellStyle}" CellEditingTemplate="{StaticResource MaterialCellEditing}" Width="300"/>
          <DataGridTemplateColumn Header="Сортаменты" CellTemplate="{StaticResource SortamentCell}" CellStyle="{StaticResource SortamentCellStyle}" CellEditingTemplate="{StaticResource SortamentCellEditing}" Width="400"/>
          <DataGridTextColumn Header="Типоразмеры" Binding="{Binding TypeSizeViewModel.TypeSize, UpdateSourceTrigger=PropertyChanged}" CellStyle="{StaticResource DataGridCellStyle}" Width="150"/>
          <DataGridTextColumn Header="Экземпляры сортаментов" Binding="{Binding SortamentEx}" CellStyle="{StaticResource DataGridCellStyle}" Width="*"/>
        </DataGrid.Columns>
      </DataGrid>
    </DockPanel>

    <Border Background="#80000000" Visibility="{Binding IsBusy, Converter={StaticResource BoolToVisibilityConverter}}" Grid.ColumnSpan="2" Panel.ZIndex="100">
      <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
        <controls:GifImage GifSource="/Resources/wait.gif" AutoStart="True" Width="64" Height="64"/>
        <TextBlock Text="Загрузка..." Foreground="White" FontSize="16" Margin="10" HorizontalAlignment="Center"/>
      </StackPanel>
    </Border>

    <!--<controls:GifImage x:Name="gifImage" GifSource="/Resources/wait.gif" AutoStart="True" Visibility="{Binding IsBusy, Converter={StaticResource BoolToVisibilityConverter}}" Stretch="Fill" HorizontalAlignment="Center" VerticalAlignment="Center"/>-->

    <!--<GridSplitter Panel.ZIndex="2" Grid.Column="1" Width="3" ShowsPreview="True" VerticalAlignment="Stretch" HorizontalAlignment="Left"/>-->
    <Border x:Name="SideBar" Panel.ZIndex="1" MinWidth="270" Visibility="{Binding CurrentSection.TypeSizeViewModel.IsTypeSizeEditing, Converter={StaticResource BoolToVisibilityConverter}, FallbackValue=Collapsed}" Grid.Column="2">
      <DockPanel Margin="5">
        <StackPanel DockPanel.Dock="Top">
          <TextBlock Text="Наименование"/>
          <TextBox Text="{Binding CurrentSection.TypeSizeViewModel.TypeSize, UpdateSourceTrigger=PropertyChanged}"/>
        </StackPanel>
        <GroupBox Header="Свойства" Margin="0 5 0 0">
          <ItemsControl ItemsSource="{Binding CurrentSection.TypeSizeViewModel.TypeSizePropertiesViewModel}" IsTabStop="False">
            <ItemsControl.ItemsPanel>
              <ItemsPanelTemplate>
                <VirtualizingStackPanel/>
              </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.Template>
              <ControlTemplate>
                <ScrollViewer x:Name="ScrollViewer" Padding="{TemplateBinding Padding}" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                  <ItemsPresenter/>
                </ScrollViewer>
              </ControlTemplate>
            </ItemsControl.Template>
            <ItemsControl.ItemTemplate>
              <DataTemplate>
                <StackPanel Margin="0 5 5 0">
                  <TextBlock Text="{Binding Name}"/>
                  <TextBox Text="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                </StackPanel>
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>
        </GroupBox>
      </DockPanel>
    </Border>
  </Grid>
</Window>